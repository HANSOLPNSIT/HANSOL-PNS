<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì—…ì²´ì •ë³´ ê´€ë¦¬ - í•œì†”PNS ITë¶€ë¬¸</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --ink: #e5e7eb;
      --muted: #9ca3af;
      --brand: #60a5fa;
      --border: rgba(255,255,255,.08);
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      background: var(--bg);
      color: var(--ink);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Ubuntu, Cantarell, Helvetica Neue, Arial;
      padding: 20px;
      line-height: 1.6;
    }
    
    .header {
      margin-bottom: 20px;
    }
    
    h1 {
      font-size: 24px;
      font-weight: 800;
      margin-bottom: 10px;
      color: var(--brand);
    }
    
    .controls {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .file-input-wrapper {
      position: relative;
      overflow: hidden;
      display: inline-block;
    }
    
    .file-input-wrapper input[type=file] {
      position: absolute;
      left: -9999px;
    }
    
    .btn {
      padding: 10px 20px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--panel);
      color: var(--ink);
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s;
    }
    
    .btn:hover {
      background: var(--brand);
      border-color: var(--brand);
      color: white;
    }
    
    .info {
      color: var(--muted);
      font-size: 14px;
      padding: 10px;
      background: rgba(96, 165, 250, 0.1);
      border-radius: 8px;
      border-left: 3px solid var(--brand);
    }
    
    .search-box {
      padding: 10px 16px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--panel);
      color: var(--ink);
      font-size: 14px;
      min-width: 300px;
    }
    
    .search-box:focus {
      outline: none;
      border-color: var(--brand);
    }
    
    .stats {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .stat-card {
      background: var(--panel);
      padding: 12px 20px;
      border-radius: 8px;
      border: 1px solid var(--border);
    }
    
    .stat-label {
      color: var(--muted);
      font-size: 12px;
      margin-bottom: 4px;
    }
    
    .stat-value {
      color: var(--brand);
      font-size: 20px;
      font-weight: 700;
    }
    
    /* í…Œì´ë¸” ì»¨í…Œì´ë„ˆ - ìŠ¤í¬ë¡¤ ì˜ì—­ */
    .table-container {
      max-height: calc(100vh - 280px);
      overflow-y: auto;
      overflow-x: auto;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: var(--panel);
      position: relative;
    }
    
    /* í…Œì´ë¸” ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      font-size: 13px;
    }
    
    /* í—¤ë” ê³ ì • - í•µì‹¬! */
    thead {
      position: sticky;
      top: 0;
      z-index: 10;
      background: var(--panel);
    }
    
    thead th {
      background: #1e293b;
      color: var(--brand);
      font-weight: 700;
      text-align: left;
      padding: 14px 12px;
      border-bottom: 2px solid var(--brand);
      white-space: nowrap;
      box-shadow: 0 2px 8px rgba(0,0,0,0.4);
      cursor: pointer;
      user-select: none;
    }
    
    thead th:hover {
      background: #2d3b52;
    }
    
    thead th.sortable::after {
      content: ' â‡…';
      opacity: 0.3;
    }
    
    thead th.sorted-asc::after {
      content: ' â†‘';
      opacity: 1;
    }
    
    thead th.sorted-desc::after {
      content: ' â†“';
      opacity: 1;
    }
    
    /* í…Œì´ë¸” ë°”ë”” */
    tbody tr {
      transition: background 0.2s;
    }
    
    tbody tr:hover {
      background: rgba(96, 165, 250, 0.1);
    }
    
    tbody tr:nth-child(even) {
      background: rgba(255,255,255,0.02);
    }
    
    tbody tr:nth-child(even):hover {
      background: rgba(96, 165, 250, 0.12);
    }
    
    tbody td {
      padding: 10px 12px;
      border-bottom: 1px solid var(--border);
    }
    
    /* ë‚ ì§œ ì»¬ëŸ¼ ìŠ¤íƒ€ì¼ */
    .date-cell {
      color: var(--brand);
      font-family: 'Courier New', monospace;
      font-weight: 500;
      white-space: nowrap;
    }
    
    /* ê¸ˆì•¡ ì»¬ëŸ¼ ìŠ¤íƒ€ì¼ */
    .amount-cell {
      text-align: right;
      font-weight: 600;
      color: #a5f3fc;
      white-space: nowrap;
    }
    
    /* ë¶„ë¥˜ ë°°ì§€ */
    .category-badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
      background: rgba(96, 165, 250, 0.15);
      color: var(--brand);
      white-space: nowrap;
    }
    
    /* í‚¤ì›Œë“œ íƒœê·¸ */
    .keyword-tag {
      display: inline-block;
      padding: 2px 6px;
      margin: 2px;
      border-radius: 3px;
      font-size: 10px;
      background: rgba(251, 191, 36, 0.2);
      color: #fbbf24;
    }
    
    /* ë¡œë”© ìƒíƒœ */
    .loading {
      text-align: center;
      padding: 40px;
      color: var(--muted);
    }
    
    .loading::after {
      content: '...';
      animation: dots 1.5s steps(4, end) infinite;
    }
    
    @keyframes dots {
      0%, 20% { content: '.'; }
      40% { content: '..'; }
      60%, 100% { content: '...'; }
    }
    
    /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
    .table-container::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }
    
    .table-container::-webkit-scrollbar-track {
      background: var(--bg);
      border-radius: 10px;
    }
    
    .table-container::-webkit-scrollbar-thumb {
      background: var(--muted);
      border-radius: 10px;
    }
    
    .table-container::-webkit-scrollbar-thumb:hover {
      background: var(--brand);
    }
    
    /* ë°˜ì‘í˜• */
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }
      
      h1 {
        font-size: 20px;
      }
      
      .search-box {
        min-width: 100%;
      }
      
      table {
        font-size: 11px;
      }
      
      thead th, tbody td {
        padding: 8px 8px;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ğŸ“¦ ì—…ì²´ì •ë³´ ê´€ë¦¬</h1>
  </div>
  
  <div class="controls">
    <div class="file-input-wrapper">
      <label for="excelFile" class="btn">ğŸ“ ì—…ì²´ì •ë³´.xlsx íŒŒì¼ ì„ íƒ</label>
      <input type="file" id="excelFile" accept=".xlsx, .xls" />
    </div>
    <input type="text" id="searchBox" class="search-box" placeholder="ğŸ” ê²€ìƒ‰ (ì—…ì²´ëª…, í’ˆëª©ëª…, í‚¤ì›Œë“œ ë“±...)" />
  </div>
  
  <div class="info" id="infoBox">
    ğŸ“Œ ì—…ì²´ì •ë³´.xlsx íŒŒì¼ì„ ì„ íƒí•˜ë©´ ìë™ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤. í—¤ë”ë¥¼ í´ë¦­í•˜ë©´ ì •ë ¬ë©ë‹ˆë‹¤.
  </div>
  
  <div class="stats" id="statsBox" style="display:none;">
    <div class="stat-card">
      <div class="stat-label">ì „ì²´ ì—…ì²´</div>
      <div class="stat-value" id="totalCount">0</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">í‘œì‹œ ì¤‘</div>
      <div class="stat-value" id="displayCount">0</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">ì´ ê¸ˆì•¡</div>
      <div class="stat-value" id="totalAmount">0ì›</div>
    </div>
  </div>
  
  <div class="table-container">
    <table id="dataTable">
      <thead>
        <tr>
          <th class="sortable" data-column="ë‚ ì§œ">ë‚ ì§œ</th>
          <th class="sortable" data-column="ì—…ì²´ëª…">ì—…ì²´ëª…</th>
          <th class="sortable" data-column="ì—…ì²´ë¶„ë¥˜ë°ë“±ê¸‰">ì—…ì²´ë¶„ë¥˜ë°ë“±ê¸‰</th>
          <th class="sortable" data-column="í’ˆëª©ëª…">í’ˆëª©ëª…</th>
          <th class="sortable" data-column="ê¸ˆì•¡">ê¸ˆì•¡</th>
          <th class="sortable" data-column="í‚¤ì›Œë“œ">í‚¤ì›Œë“œ</th>
          <th class="sortable" data-column="ë‹´ë‹¹ì">ë‹´ë‹¹ì</th>
          <th class="sortable" data-column="ì—°ë½ì²˜">ì—°ë½ì²˜</th>
          <th class="sortable" data-column="ëŒ€ë¶„ë¥˜">ëŒ€ë¶„ë¥˜</th>
          <th class="sortable" data-column="ì¤‘ë¶„ë¥˜">ì¤‘ë¶„ë¥˜</th>
          <th class="sortable" data-column="ì†Œë¶„ë¥˜">ì†Œë¶„ë¥˜</th>
        </tr>
      </thead>
      <tbody id="dataBody">
        <tr>
          <td colspan="11" class="loading">íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”</td>
        </tr>
      </tbody>
    </table>
  </div>

  <script>
    let allData = [];
    let filteredData = [];
    let currentSort = { column: null, direction: 'asc' };

    // ë‚ ì§œë¥¼ YYYY-MM-DD í˜•ì‹ìœ¼ë¡œ ë³€í™˜
    function formatDate(value) {
      if (!value) return '';
      
      // ì´ë¯¸ YYYY-MM-DD í˜•ì‹ì´ë©´ ê·¸ëŒ€ë¡œ ë°˜í™˜
      if (typeof value === 'string' && /^\d{4}-\d{2}-\d{2}$/.test(value)) {
        return value;
      }
      
      let date;
      
      // Excel ë‚ ì§œ ì‹œë¦¬ì–¼ ë²ˆí˜¸ì¸ ê²½ìš°
      if (typeof value === 'number') {
        // Excelì€ 1900ë…„ 1ì›” 1ì¼ì„ 1ë¡œ ì‹œì‘ (1900-01-01 = 1)
        const excelEpoch = new Date(1899, 11, 30); // 1899-12-30
        date = new Date(excelEpoch.getTime() + value * 86400000);
      } else {
        date = new Date(value);
      }
      
      if (isNaN(date.getTime())) return value; // ë³€í™˜ ì‹¤íŒ¨ ì‹œ ì›ë³¸ ë°˜í™˜
      
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      
      return `${year}-${month}-${day}`;
    }

    // ê¸ˆì•¡ì„ í•œêµ­ ì›í™” í˜•ì‹ìœ¼ë¡œ ë³€í™˜
    function formatCurrency(amount) {
      if (!amount && amount !== 0) return '';
      const num = typeof amount === 'string' ? parseFloat(amount.replace(/[^0-9.-]/g, '')) : amount;
      if (isNaN(num)) return amount;
      return new Intl.NumberFormat('ko-KR').format(num) + 'ì›';
    }

    // í‚¤ì›Œë“œë¥¼ íƒœê·¸ë¡œ ë³€í™˜
    function formatKeywords(keywords) {
      if (!keywords) return '';
      const keywordArray = keywords.toString().split(/[,;\/]/).map(k => k.trim()).filter(k => k);
      return keywordArray.map(k => `<span class="keyword-tag">${k}</span>`).join('');
    }

    // ì—‘ì…€ íŒŒì¼ ì½ê¸°
    document.getElementById('excelFile').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      document.getElementById('infoBox').innerHTML = 'â³ íŒŒì¼ì„ ì½ëŠ” ì¤‘...';
      document.getElementById('dataBody').innerHTML = '<tr><td colspan="11" class="loading">ë°ì´í„° ë¡œë”© ì¤‘</td></tr>';
      
      const reader = new FileReader();
      
      reader.onload = function(e) {
        try {
          const data = new Uint8Array(e.target.result);
          const workbook = XLSX.read(data, { type: 'array', cellDates: true });
          
          // ì²« ë²ˆì§¸ ì‹œíŠ¸ ì½ê¸°
          const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
          const jsonData = XLSX.utils.sheet_to_json(firstSheet);
          
          if (jsonData.length === 0) {
            document.getElementById('infoBox').innerHTML = 'âš ï¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.';
            return;
          }
          
          allData = jsonData;
          filteredData = [...allData];
          
          document.getElementById('infoBox').innerHTML = 
            `âœ… ì´ <strong>${allData.length}ê±´</strong>ì˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤. (íŒŒì¼: ${file.name})`;
          document.getElementById('statsBox').style.display = 'flex';
          
          renderTable(filteredData);
          updateStats(filteredData);
          
        } catch (error) {
          console.error('íŒŒì¼ ì½ê¸° ì˜¤ë¥˜:', error);
          document.getElementById('infoBox').innerHTML = 
            'âŒ íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message;
        }
      };
      
      reader.onerror = function() {
        document.getElementById('infoBox').innerHTML = 'âŒ íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
      };
      
      reader.readAsArrayBuffer(file);
    });

    // í…Œì´ë¸” ë Œë”ë§
    function renderTable(data) {
      const tbody = document.getElementById('dataBody');
      tbody.innerHTML = '';
      
      if (data.length === 0) {
        tbody.innerHTML = '<tr><td colspan="11" style="text-align:center; padding:40px; color:var(--muted);">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        return;
      }
      
      data.forEach((row, index) => {
        const tr = document.createElement('tr');
        
        tr.innerHTML = `
          <td class="date-cell">${formatDate(row['ë‚ ì§œ'] || row['date'] || '')}</td>
          <td><strong>${row['ì—…ì²´ëª…'] || ''}</strong></td>
          <td><span class="category-badge">${row['ì—…ì²´ë¶„ë¥˜ë°ë“±ê¸‰'] || ''}</span></td>
          <td>${row['í’ˆëª©ëª…'] || ''}</td>
          <td class="amount-cell">${formatCurrency(row['ê¸ˆì•¡'] || '')}</td>
          <td>${formatKeywords(row['í‚¤ì›Œë“œ'] || '')}</td>
          <td>${row['ë‹´ë‹¹ì'] || ''}</td>
          <td>${row['ì—°ë½ì²˜'] || ''}</td>
          <td>${row['ëŒ€ë¶„ë¥˜'] || ''}</td>
          <td>${row['ì¤‘ë¶„ë¥˜'] || ''}</td>
          <td>${row['ì†Œë¶„ë¥˜'] || ''}</td>
        `;
        
        tbody.appendChild(tr);
      });
    }

    // í†µê³„ ì—…ë°ì´íŠ¸
    function updateStats(data) {
      document.getElementById('totalCount').textContent = allData.length;
      document.getElementById('displayCount').textContent = data.length;
      
      const total = data.reduce((sum, row) => {
        const amount = row['ê¸ˆì•¡'] || 0;
        const num = typeof amount === 'string' ? parseFloat(amount.replace(/[^0-9.-]/g, '')) : amount;
        return sum + (isNaN(num) ? 0 : num);
      }, 0);
      
      document.getElementById('totalAmount').textContent = formatCurrency(total);
    }

    // ê²€ìƒ‰ ê¸°ëŠ¥
    document.getElementById('searchBox').addEventListener('input', function(e) {
      const keyword = e.target.value.toLowerCase().trim();
      
      if (!keyword) {
        filteredData = [...allData];
      } else {
        filteredData = allData.filter(row => {
          return Object.values(row).some(value => {
            if (value === null || value === undefined) return false;
            return value.toString().toLowerCase().includes(keyword);
          });
        });
      }
      
      renderTable(filteredData);
      updateStats(filteredData);
    });

    // ì •ë ¬ ê¸°ëŠ¥
    document.querySelectorAll('thead th.sortable').forEach(th => {
      th.addEventListener('click', function() {
        const column = this.dataset.column;
        
        // ì •ë ¬ ë°©í–¥ ê²°ì •
        if (currentSort.column === column) {
          currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
        } else {
          currentSort.column = column;
          currentSort.direction = 'asc';
        }
        
        // í—¤ë” ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
        document.querySelectorAll('thead th.sortable').forEach(h => {
          h.classList.remove('sorted-asc', 'sorted-desc');
        });
        this.classList.add(currentSort.direction === 'asc' ? 'sorted-asc' : 'sorted-desc');
        
        // ë°ì´í„° ì •ë ¬
        filteredData.sort((a, b) => {
          let aVal = a[column];
          let bVal = b[column];
          
          // ë‚ ì§œ ì²˜ë¦¬
          if (column === 'ë‚ ì§œ') {
            aVal = new Date(formatDate(aVal));
            bVal = new Date(formatDate(bVal));
          }
          // ê¸ˆì•¡ ì²˜ë¦¬
          else if (column === 'ê¸ˆì•¡') {
            aVal = typeof aVal === 'string' ? parseFloat(aVal.replace(/[^0-9.-]/g, '')) : (aVal || 0);
            bVal = typeof bVal === 'string' ? parseFloat(bVal.replace(/[^0-9.-]/g, '')) : (bVal || 0);
          }
          // ë¬¸ìì—´ ì²˜ë¦¬
          else {
            aVal = (aVal || '').toString().toLowerCase();
            bVal = (bVal || '').toString().toLowerCase();
          }
          
          if (aVal < bVal) return currentSort.direction === 'asc' ? -1 : 1;
          if (aVal > bVal) return currentSort.direction === 'asc' ? 1 : -1;
          return 0;
        });
        
        renderTable(filteredData);
      });
    });
  </script>
</body>
</html>
