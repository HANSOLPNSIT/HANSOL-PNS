<!DOCTYPE html>
<html lang="ko" data-branch="">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>한솔PNS IT부문 구매팀 페이지</title>
  <style>
    :root {
      --bg:#ffffff; --panel:#f5f6f8; --ink:#111827; --muted:#6b7280; --brand:#2563eb;
    }
    *{box-sizing:border-box}
    body{margin:0; background:var(--bg); color:var(--ink);
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",Ubuntu,Cantarell,"Helvetica Neue",Arial;}
    .layout{display:grid; grid-template-columns:260px 1fr; min-height:100vh}
    .sidebar{background:var(--panel); border-right:1px solid #e5e7eb; padding:18px 14px; position:sticky; top:0; height:100vh; display:flex; flex-direction:column}
    h1{margin:0 0 12px; font-size:18px; font-weight:800}
    .sub{color:var(--muted); font-size:12px; margin-bottom:14px}
    .search{width:100%; padding:10px 12px; border-radius:10px; border:1px solid #d1d5db; background:#fff; color:var(--ink); margin-bottom:12px; flex-shrink:0}
    .nav{display:flex; flex-direction:column; gap:8px; margin-top:8px; overflow-y:auto; flex:1; min-height:0}
    .nav a{text-decoration:none; color:var(--ink); font-size:14px; padding:10px 10px; border-radius:10px; border:1px solid transparent; display:flex; justify-content:space-between; align-items:center}
    .nav a:hover{background:#e5e7eb; border-color:#d1d5db}
    .nav a.active{border-color:#2563eb; background:#e0e7ff}
    .tag{font-size:11px; color:var(--muted)}
    .main{position:relative}
    .viewer{position:absolute; inset:0; border:0; width:100%; height:100%; background:#ffffff}
    .topbar{position:sticky; top:0; z-index:1; background:linear-gradient(0deg, rgba(255,255,255,0), rgba(255,255,255,.9)); padding:10px 14px; font-size:12px; color:var(--muted); border-bottom:1px solid #e5e7eb;}
    .note{font-size:11px; color:var(--muted); margin-top:8px; flex-shrink:0}
    @media (max-width:900px){ .layout{grid-template-columns:1fr} .sidebar{position:sticky; top:0; z-index:2} }
  </style>
</head>
<body>
  <div class="layout">
    <aside class="sidebar">
      <h1>한솔PNS IT부문 구매팀 페이지</h1>
      <div class="sub">왼쪽에서 카테고리를 선택하면 오른쪽에 열립니다.</div>
      <input id="q" class="search" placeholder="검색 (파일명)" />
      <nav id="nav" class="nav"></nav>
      <div class="note" id="note"></div>
    </aside>

    <main class="main">
      <div class="topbar"><span id="crumb"></span></div>
      <iframe id="viewer" class="viewer" src=""></iframe>
    </main>
  </div>

  <script>
    const EXCLUDE = new Set(["index.html","404.html",".well-known"]);
    const CACHE_TTL_MS = 10 * 60 * 1000;

    const navEl = document.getElementById('nav');
    const viewer = document.getElementById('viewer');
    const crumb  = document.getElementById('crumb');
    const search = document.getElementById('q');
    const note   = document.getElementById('note');

    const pretty = (name) => {
      const base = name.replace(/\.(html?|HTML?)$/,'');
      return base
        .replace(/[-_]+/g,' ')
        .replace(/\b([a-z])/g, m=>m.toUpperCase());
    };

    function detectRepoInfo(){
      const host = location.host;
      const path = location.pathname;
      const user = host.split('.')[0];
      const segs = path.split('/').filter(Boolean);
      const repo = segs.length ? segs[0] : `${user}.github.io`;
      return { user, repo };
    }

    async function fetchContents(user, repo, branchHint){
      const candidates = [];
      if (branchHint) candidates.push(branchHint);
      candidates.push("gh-pages","main");
      const tried = new Set();
      for (const ref of candidates){
        if (tried.has(ref)) continue;
        tried.add(ref);
        const url = `https://api.github.com/repos/${user}/${repo}/contents/?ref=${encodeURIComponent(ref)}`;
        const res = await fetch(url, { headers: { 'Accept': 'application/vnd.github.v3+json' } });
        if (res.ok){
          const data = await res.json();
          return { list: data, branch: ref };
        }
      }
      throw new Error("목록을 가져올 수 없습니다. (gh-pages/main 모두 실패)");
    }

    function cacheGet(key){
      try{
        const raw = localStorage.getItem(key);
        if (!raw) return null;
        const obj = JSON.parse(raw);
        if (Date.now() - obj.ts > CACHE_TTL_MS) return null;
        return obj.data;
      }catch(_){ return null; }
    }
    function cacheSet(key, data){
      try{ localStorage.setItem(key, JSON.stringify({ ts: Date.now(), data })); }catch(_){}
    }

    function renderNav(pages, filter=""){
      navEl.innerHTML = "";
      const kw = filter.trim().toLowerCase();
      const list = pages.filter(p => !kw || p.title.toLowerCase().includes(kw) || p.name.toLowerCase().includes(kw));
      list.forEach(p => {
        const a = document.createElement('a');
        a.href = "#"+encodeURIComponent(p.name);
        a.dataset.path = p.name;
        a.innerHTML = `<span>${p.title}</span><span class="tag">${p.name}</span>`;
        a.addEventListener('click', (e) => {
          e.preventDefault();
          openPage(p.name, p.title);
          setActive(p.name);
          history.replaceState(null, "", a.href);
        });
        navEl.appendChild(a);
      });
      const hashPath = decodeURIComponent(location.hash.slice(1)||"");
      setActive(hashPath || (list[0]?.name||""));
    }

    function setActive(path){
      [...navEl.querySelectorAll('a')].forEach(a => {
        a.classList.toggle('active', a.dataset.path === path);
      });
    }
    function openPage(path, title){
      viewer.src = path;
      crumb.textContent = title ? `열람 중: ${title} (${path})` : path;
      document.title = `한솔PNS IT부문 구매팀 페이지 · ${title||path}`;
    }

    async function init(){
      const branchHint = (document.documentElement.getAttribute('data-branch')||"").trim() || null;
      const { user, repo } = detectRepoInfo();
      const cacheKey = `gh_list_${user}_${repo}_${branchHint||'auto'}`;
      let pages = cacheGet(cacheKey);
      let branchUsed = null;

      if (!pages){
        try{
          const { list, branch } = await fetchContents(user, repo, branchHint);
          branchUsed = branch;
          const files = list
            .filter(it => it.type === "file")
            .filter(it => /\.(html?|HTML?)$/.test(it.name))
            .filter(it => ![...EXCLUDE].some(ex => it.name === ex || it.name.startsWith(ex)));
          pages = files
            .map(it => ({ name: it.name, title: pretty(it.name) }))
            .sort((a,b) => a.title.localeCompare(b.title,'ko'));
          cacheSet(cacheKey, pages);
        }catch(err){
          note.textContent = "자동 목록 로드 실패: " + err.message;
          pages = [];
        }
      }

      if (pages.length === 0){
        note.textContent = (note.textContent? note.textContent+" · " : "") +
          "루트에 .html 파일을 추가하면 자동으로 목록에 표시됩니다.";
      }else{
        note.textContent = `자동 로드됨 (브랜치: ${branchUsed || branchHint || "캐시"})`;
      }

      renderNav(pages);
      search.addEventListener('input', () => renderNav(pages, search.value));

      const initial = decodeURIComponent(location.hash.slice(1)||"") || (pages[0]?.name);
      if (initial){
        const meta = pages.find(p=>p.name===initial) || pages[0];
        openPage(meta.name, meta.title);
        setActive(meta.name);
        if(!location.hash) history.replaceState(null, "", "#"+encodeURIComponent(meta.name));
      }
    }

    window.addEventListener('hashchange', () => {
      const path = decodeURIComponent(location.hash.slice(1)||"");
      if (!path) return;
      openPage(path, pretty(path));
      setActive(path);
    });

    init();
  </script>
</body>
</html>
