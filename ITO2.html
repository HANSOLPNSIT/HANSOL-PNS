<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ITO ë°œì£¼ì„œ PDF ì¶œë ¥</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
:root{
  --bg:#0f172a;--panel:#1e293b;--ink:#e2e8f0;--muted:#94a3b8;
  --accent:#3b82f6;--border:#334155;--paper:#fff;--ink2:#1e293b;
}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;background:var(--bg);color:var(--ink);min-height:100vh}

header{background:var(--panel);border-bottom:1px solid var(--border);padding:20px;position:sticky;top:0;z-index:100}
.header-content{max-width:1200px;margin:0 auto;display:flex;gap:16px;align-items:center;flex-wrap:wrap}
.btn{padding:10px 18px;border-radius:8px;border:none;cursor:pointer;font-size:14px;font-weight:500;transition:all .2s}
.btn-primary{background:var(--accent);color:#fff}
.btn-primary:hover{background:#2563eb}
.btn-success{background:#10b981;color:#fff}
.btn-success:hover{background:#059669}
.btn:disabled{opacity:.5;cursor:not-allowed}
.file-input{padding:8px 14px;border:1px solid var(--border);border-radius:8px;background:#0f172a;color:var(--ink);font-size:14px}
.select{padding:8px 14px;border:1px solid var(--border);border-radius:8px;background:#0f172a;color:var(--ink);font-size:14px;min-width:200px}

main{max-width:1200px;margin:20px auto;padding:0 20px}
.controls{background:var(--panel);padding:20px;border-radius:12px;margin-bottom:20px;border:1px solid var(--border)}
.control-row{display:flex;gap:12px;align-items:center;margin-bottom:12px}
.control-row:last-child{margin-bottom:0}
.label{font-size:14px;color:var(--muted);min-width:100px}
.hint{font-size:12px;color:var(--muted);margin-top:8px}

.paper-container{background:var(--panel);padding:20px;border-radius:12px;border:1px solid var(--border)}
.paper{width:210mm;min-height:297mm;background:var(--paper);color:var(--ink2);margin:0 auto;padding:20mm;position:relative;box-shadow:0 4px 20px rgba(0,0,0,.3)}

.po-header{text-align:center;margin-bottom:25mm;position:relative}
.po-title{font-size:28px;font-weight:800;letter-spacing:3px;margin-bottom:8px}
.po-subtitle{font-size:14px;color:#6b7280}
.logo{position:absolute;right:0;top:0;width:60px;height:60px;opacity:.2}

.info-section{margin-bottom:15mm}
.info-row{display:flex;gap:10px;margin-bottom:6px}
.info-label{font-size:13px;color:#374151;font-weight:600;min-width:80px}
.info-value{flex:1;padding:6px 10px;border:1px solid #d1d5db;border-radius:4px;font-size:13px}

.table-section{margin:15mm 0}
.section-title{font-size:15px;font-weight:700;margin-bottom:8px;color:#111827}
table{width:100%;border-collapse:collapse;margin-bottom:10mm}
th,td{border:1px solid #d1d5db;padding:8px;font-size:13px}
th{background:#f9fafb;font-weight:600;text-align:center}
.text-right{text-align:right}
.text-center{text-align:center}

.summary-table{width:60%;margin-left:auto}
.footer-section{margin-top:20mm;display:grid;grid-template-columns:1fr 1fr;gap:20px}
.footer-box{border:1px solid #d1d5db;padding:15px;border-radius:6px}
.footer-title{font-weight:700;margin-bottom:10px;font-size:14px}
.footer-content{font-size:12px;line-height:1.6;color:#4b5563}

@media print{
  body{background:#fff}
  header,.controls{display:none}
  .paper-container{background:none;padding:0;border:none}
  .paper{box-shadow:none;margin:0;page-break-after:always}
}
</style>
</head>
<body>

<header>
  <div class="header-content">
    <strong style="font-size:18px">ğŸ“„ ITO ë°œì£¼ì„œ ìƒì„±ê¸°</strong>
    <input type="file" id="fileInput" accept=".xlsx,.xls" class="file-input">
    <button id="fillBtn" class="btn btn-primary" disabled>ğŸ“‹ ì‹œíŠ¸ì—ì„œ ì±„ìš°ê¸°</button>
    <button id="pdfBtn" class="btn btn-success" disabled>ğŸ’¾ PDF ë‹¤ìš´ë¡œë“œ</button>
  </div>
</header>

<main>
  <div class="controls">
    <div class="control-row">
      <span class="label">ë°œì£¼ë²ˆí˜¸ ì„ íƒ:</span>
      <select id="poSelect" class="select" disabled>
        <option value="">íŒŒì¼ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>
      </select>
    </div>
    <div class="hint">â€» ITO.xlsx íŒŒì¼ì„ ì„ íƒí•˜ë©´ '25ë…„' ì‹œíŠ¸ì˜ ë°œì£¼ë²ˆí˜¸ ëª©ë¡ì´ ìë™ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.</div>
  </div>

  <div class="paper-container">
    <div class="paper" id="printArea">
      <div class="logo">ğŸ¢</div>
      
      <div class="po-header">
        <div class="po-title">ë°œ ì£¼ ì„œ</div>
        <div class="po-subtitle">PURCHASE ORDER</div>
      </div>

      <div class="info-section">
        <div class="info-row">
          <div class="info-label">ë°œì£¼ë²ˆí˜¸</div>
          <div class="info-value" id="poNumber">-</div>
          <div class="info-label">ë°œì£¼ì¼ì</div>
          <div class="info-value" id="poDate">-</div>
        </div>
        <div class="info-row">
          <div class="info-label">ê³µê¸‰ì²˜</div>
          <div class="info-value" id="supplier">ãˆœì•„ì´í‹°ì˜¤</div>
        </div>
      </div>

      <div class="table-section">
        <div class="section-title">â–  ë°œì£¼ ë‚´ì—­</div>
        <table>
          <thead>
            <tr>
              <th style="width:60px">No</th>
              <th style="width:80px">ë°œì£¼ë²ˆí˜¸</th>
              <th>ë‚´ìš©</th>
              <th style="width:80px">ìˆ˜ëŸ‰</th>
              <th style="width:60px">ë‹¨ìœ„</th>
              <th style="width:100px">ë‹¨ê°€(ì›)</th>
              <th style="width:120px">ê¸ˆì•¡(ì›)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-center">1</td>
              <td class="text-center" id="itemPoNo">-</td>
              <td id="itemContent">-</td>
              <td class="text-right" id="itemQty">-</td>
              <td class="text-center" id="itemUnit">-</td>
              <td class="text-right" id="itemPrice">-</td>
              <td class="text-right" id="itemAmount">-</td>
            </tr>
          </tbody>
        </table>
      </div>

      <table class="summary-table">
        <tr>
          <th style="width:100px">ê³µê¸‰ê°€ì•¡</th>
          <td class="text-right" id="supplyAmount">0</td>
        </tr>
        <tr>
          <th>ë¶€ê°€ì„¸(10%)</th>
          <td class="text-right" id="taxAmount">0</td>
        </tr>
        <tr>
          <th>í•©ê³„ê¸ˆì•¡</th>
          <td class="text-right" id="totalAmount" style="font-weight:700">0</td>
        </tr>
      </table>

      <div class="info-section" style="margin-top:15mm">
        <div class="section-title">â–  ê¸°ê°„ ì •ë³´</div>
        <div class="info-row">
          <div class="info-label">ê³„ì•½ì‹œì‘(FROM)</div>
          <div class="info-value" id="fromDate">-</div>
          <div class="info-label">ê³„ì•½ì¢…ë£Œ(TO)</div>
          <div class="info-value" id="toDate">-</div>
        </div>
        <div class="info-row">
          <div class="info-label">ê³„ì•½ê¸°ê°„</div>
          <div class="info-value" id="period">-</div>
        </div>
      </div>

      <div class="footer-section">
        <div class="footer-box">
          <div class="footer-title">ê²€ìˆ˜ ê¸°ì¤€</div>
          <div class="footer-content">
            1. ì œí’ˆì˜ í’ˆì§ˆ ë° ì‚¬ì–‘ ì í•©ì„± í™•ì¸<br>
            2. ìˆ˜ëŸ‰ ë° í¬ì¥ ìƒíƒœ ì ê²€<br>
            3. ë‚©ê¸°ì¼ ì¤€ìˆ˜ ì—¬ë¶€ í™•ì¸
          </div>
        </div>
        <div class="footer-box">
          <div class="footer-title">íŠ¹ì´ ì‚¬í•­</div>
          <div class="footer-content">
            â€¢ ë³¸ ë°œì£¼ì„œì— ê¸°ì¬ëœ ë‚´ìš©ëŒ€ë¡œ ê³µê¸‰í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.<br>
            â€¢ ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ë‹´ë‹¹ìì—ê²Œ ì—°ë½ ë°”ëë‹ˆë‹¤.
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<script>
let workbook = null;
let sheetData = null;

const fileInput = document.getElementById('fileInput');
const poSelect = document.getElementById('poSelect');
const fillBtn = document.getElementById('fillBtn');
const pdfBtn = document.getElementById('pdfBtn');

fileInput.addEventListener('change', handleFile);
fillBtn.addEventListener('click', fillData);
pdfBtn.addEventListener('click', generatePDF);

function handleFile(e) {
  const file = e.target.files[0];
  if (!file) return;
  
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      workbook = XLSX.read(e.target.result, {type: 'binary'});
      
      let targetSheet = workbook.Sheets['25ë…„'] || workbook.Sheets[workbook.SheetNames[0]];
      sheetData = XLSX.utils.sheet_to_json(targetSheet, {header: 1, defval: ''});
      
      if (sheetData.length === 0) {
        alert('ì‹œíŠ¸ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      const headers = sheetData[0];
      const poColIdx = headers.findIndex(h => h === 'ë°œì£¼ë²ˆí˜¸');
      
      if (poColIdx === -1) {
        alert('"ë°œì£¼ë²ˆí˜¸" ì—´ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      const poNumbers = [];
      for (let i = 1; i < sheetData.length; i++) {
        const poNum = sheetData[i][poColIdx];
        if (poNum) poNumbers.push(poNum);
      }
      
      poSelect.innerHTML = '<option value="">ë°œì£¼ë²ˆí˜¸ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
      poNumbers.forEach(po => {
        const opt = document.createElement('option');
        opt.value = po;
        opt.textContent = po;
        poSelect.appendChild(opt);
      });
      
      poSelect.disabled = false;
      fillBtn.disabled = false;
      pdfBtn.disabled = false;
      
    } catch (err) {
      alert('íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: ' + err.message);
    }
  };
  reader.readAsBinaryString(file);
}

function fillData() {
  const selectedPO = poSelect.value;
  if (!selectedPO || !sheetData) return;
  
  const headers = sheetData[0];
  const getColIdx = (name) => headers.findIndex(h => h === name);
  
  const poColIdx = getColIdx('ë°œì£¼ë²ˆí˜¸');
  const rowIdx = sheetData.findIndex((row, idx) => idx > 0 && row[poColIdx] === selectedPO);
  
  if (rowIdx === -1) {
    alert('í•´ë‹¹ ë°œì£¼ë²ˆí˜¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    return;
  }
  
  const row = sheetData[rowIdx];
  const getValue = (colName, defaultVal = '-') => {
    const idx = getColIdx(colName);
    return idx !== -1 && row[idx] ? row[idx] : defaultVal;
  };
  
  document.getElementById('poNumber').textContent = selectedPO;
  document.getElementById('poDate').textContent = formatDate(getValue('ë°œì£¼ì¼ì'));
  document.getElementById('itemPoNo').textContent = selectedPO;
  document.getElementById('itemContent').textContent = getValue('ë‚´ìš©', 'í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ ìš´ì˜ ë° ìœ ì§€ë³´ìˆ˜');
  
  const qty = parseFloat(getValue('ìˆ˜ëŸ‰', 12)) || 12;
  const unit = getValue('ë‹¨ìœ„', 'ê°œì›”');
  const price = parseFloat(getValue('ë‹¨ê°€', 10920000)) || 10920000;
  const amount = parseFloat(getValue('ë°œì£¼ê¸ˆì•¡', qty * price)) || (qty * price);
  
  document.getElementById('itemQty').textContent = formatNumber(qty);
  document.getElementById('itemUnit').textContent = unit;
  document.getElementById('itemPrice').textContent = formatNumber(price);
  document.getElementById('itemAmount').textContent = formatNumber(amount);
  
  const supplyAmt = Math.round(amount);
  const taxAmt = Math.round(supplyAmt * 0.1);
  const totalAmt = supplyAmt + taxAmt;
  
  document.getElementById('supplyAmount').textContent = formatNumber(supplyAmt);
  document.getElementById('taxAmount').textContent = formatNumber(taxAmt);
  document.getElementById('totalAmount').textContent = formatNumber(totalAmt);
  
  const fromDate = getValue('FROM');
  const toDate = getValue('TO');
  document.getElementById('fromDate').textContent = formatDate(fromDate);
  document.getElementById('toDate').textContent = formatDate(toDate);
  
  if (fromDate && toDate && fromDate !== '-' && toDate !== '-') {
    const from = parseExcelDate(fromDate);
    const to = parseExcelDate(toDate);
    if (from && to) {
      const months = Math.round((to - from) / (1000 * 60 * 60 * 24 * 30));
      document.getElementById('period').textContent = months + ' ê°œì›”';
    }
  } else {
    document.getElementById('period').textContent = '-';
  }
  
  document.getElementById('supplier').textContent = getValue('ê³µê¸‰ì²˜', 'ãˆœì•„ì´í‹°ì˜¤');
}

function parseExcelDate(val) {
  if (typeof val === 'number') {
    return new Date((val - 25569) * 86400 * 1000);
  }
  if (typeof val === 'string' && val.includes('-')) {
    return new Date(val);
  }
  return null;
}

function formatDate(val) {
  if (!val || val === '-') return '-';
  const d = parseExcelDate(val);
  if (!d) return val;
  const y = d.getFullYear();
  const m = String(d.getMonth() + 1).padStart(2, '0');
  const day = String(d.getDate()).padStart(2, '0');
  return `${y}-${m}-${day}`;
}

function formatNumber(num) {
  if (isNaN(num)) return '-';
  return new Intl.NumberFormat('ko-KR').format(num);
}

function generatePDF() {
  const element = document.getElementById('printArea');
  const opt = {
    margin: 0,
    filename: `ë°œì£¼ì„œ_${document.getElementById('poNumber').textContent || 'ITO'}.pdf`,
    image: { type: 'jpeg', quality: 0.98 },
    html2canvas: { scale: 2, useCORS: true },
    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
  };
  
  html2pdf().set(opt).from(element).save();
}
</script>

</body>
</html>